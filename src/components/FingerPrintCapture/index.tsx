import React, { useEffect, useState } from "react";
import { FingerprintSdk } from "../../fingerprint_reader/api/sdk_mod";
import { useAppDispatch, useAppSelector } from "../../store/hooks";
import { storeFingerPrint } from "../../store/fingerprint/fingerPrintSlice";

const FingerPrintCapture: React.FC = () => {
  const { image } = useAppSelector((state) => state.fingerPrint);
  const [fingerprint, setFingerprint] = useState<any | null>(null);
  const [deviceId, setDeviceId] = useState<string>("");
const dispatch = useAppDispatch();
  useEffect(() => {
    const initializeFingerprintSdk = async () => {
      try {
        const fingerprintInstance = new FingerprintSdk();
        setFingerprint(fingerprintInstance);

        const devices = await fingerprintInstance.getDeviceList();
        if (devices.length > 0) {
          setDeviceId(devices[0]);
        }
      } catch (error) {
        console.log(error);
      }
    };

    initializeFingerprintSdk();

    return () => {
      dispatch(storeFingerPrint(""));
      if (fingerprint) {
        fingerprint.stopCapture();
      }
    };
  }, []);

  useEffect(() => {
    if (deviceId) {
      startCapturing();
    }
  }, [deviceId]); // Add `deviceId` as a dependency here

  const startCapturing = () => {
    if (fingerprint) {
      fingerprint.startCapture();
    }
  };

  const stopCapturing = () => {
    if (fingerprint) {
      fingerprint.stopCapture();
    }
  };

  // Rest of the component code...

  return (
    <div className="">
      {image ? (
        <img
          style={{ width: "178px", height: "178px", objectFit: "contain" }}
          src={"data:image/png;base64," + image}
        />
      ) : (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="178"
          height="178"
          viewBox="0 0 178 178"
          fill="none"
        >
          <path
            d="M102.114 155.524C101.461 155.522 100.823 155.333 100.274 154.979C99.5203 154.496 98.9867 153.736 98.7891 152.862C98.5915 151.989 98.7457 151.073 99.2184 150.313C108.146 136.3 112.874 120.023 112.843 103.408V92.4063C112.843 91.5029 113.202 90.6365 113.841 89.9977C114.48 89.3589 115.346 89 116.25 89C117.153 89 118.019 89.3589 118.658 89.9977C119.297 90.6365 119.656 91.5029 119.656 92.4063V103.374C119.699 121.292 114.604 138.847 104.975 153.957C104.667 154.437 104.244 154.832 103.744 155.105C103.244 155.379 102.684 155.523 102.114 155.524Z"
            fill="#077C5A"
          />
          <path
            d="M61.75 95.8125C60.8466 95.8125 59.9802 95.4536 59.3414 94.8148C58.7026 94.176 58.3438 93.3096 58.3438 92.4062V82.1875C58.3353 74.385 61.3023 66.8729 66.6401 61.182C71.9779 55.491 79.2848 52.0496 87.0718 51.5588C94.8588 51.068 102.54 53.5649 108.55 58.5407C114.56 63.5165 118.447 70.5966 119.418 78.3384C119.535 79.2418 119.289 80.1549 118.733 80.8767C118.178 81.5985 117.358 82.07 116.454 82.1875C115.551 82.3049 114.638 82.0587 113.916 81.5029C113.194 80.9472 112.723 80.1274 112.605 79.224C111.764 73.2823 108.713 67.8762 104.062 64.0846C99.4103 60.2931 93.5001 58.395 87.5107 58.769C81.5214 59.1431 75.8933 61.7619 71.7497 66.1027C67.6061 70.4435 65.2516 76.1872 65.1563 82.1875V92.4062C65.1563 93.3096 64.7974 94.176 64.1586 94.8148C63.5198 95.4536 62.6534 95.8125 61.75 95.8125Z"
            fill="#077C5A"
          />
          <path
            d="M46.7281 137.028C46.0585 137.025 45.4046 136.825 44.8481 136.453C44.2915 136.081 43.8571 135.553 43.5991 134.935C43.341 134.317 43.2708 133.637 43.3972 132.979C43.5236 132.321 43.8409 131.716 44.3097 131.238L48.5675 126.946C54.2689 121.303 57.7405 113.792 58.3434 105.793C58.4039 104.931 58.7892 104.125 59.4216 103.537C60.054 102.949 60.8861 102.623 61.7497 102.625C62.2178 102.624 62.6811 102.719 63.1107 102.905C63.5403 103.091 63.927 103.363 64.2466 103.705C64.5663 104.047 64.812 104.452 64.9684 104.893C65.1249 105.334 65.1887 105.803 65.1559 106.27C64.4631 115.887 60.3273 124.933 53.5065 131.748L49.1465 136.006C48.8311 136.328 48.4549 136.584 48.0397 136.76C47.6246 136.935 47.1788 137.026 46.7281 137.028Z"
            fill="#077C5A"
          />
          <path
            d="M122.416 145.714C121.958 145.722 121.504 145.629 121.087 145.441C120.256 145.088 119.6 144.42 119.261 143.584C118.923 142.747 118.93 141.81 119.282 140.979C119.588 140.264 119.861 139.514 120.099 138.765C120.242 138.34 120.468 137.947 120.763 137.61C121.058 137.272 121.416 136.995 121.818 136.796C122.22 136.597 122.657 136.479 123.104 136.448C123.551 136.418 124 136.476 124.425 136.619C124.85 136.762 125.243 136.988 125.581 137.283C125.918 137.577 126.195 137.936 126.394 138.338C126.593 138.739 126.712 139.176 126.742 139.624C126.772 140.071 126.714 140.52 126.571 140.945C126.265 141.831 125.924 142.716 125.549 143.636C125.289 144.252 124.852 144.777 124.295 145.146C123.738 145.516 123.084 145.713 122.416 145.714Z"
            fill="#077C5A"
          />
          <path
            d="M126.469 133.588H125.583C125.128 133.485 124.698 133.291 124.321 133.016C123.944 132.741 123.628 132.391 123.391 131.989C123.155 131.586 123.004 131.14 122.947 130.676C122.891 130.213 122.93 129.743 123.063 129.296C125.342 120.844 126.487 112.127 126.469 103.374V82.1873C126.489 77.2005 125.501 72.2611 123.563 67.666C121.626 63.071 118.779 58.9151 115.194 55.4482C114.544 54.8158 114.171 53.951 114.159 53.0439C114.146 52.1368 114.494 51.2618 115.126 50.6113C115.759 49.9609 116.623 49.5883 117.531 49.5755C118.438 49.5628 119.313 49.9108 119.963 50.5432C124.19 54.6562 127.547 59.5769 129.835 65.0129C132.123 70.449 133.295 76.2894 133.282 82.1873V103.374C133.364 112.714 132.219 122.025 129.875 131.067C129.676 131.81 129.23 132.464 128.612 132.921C127.993 133.379 127.238 133.614 126.469 133.588Z"
            fill="#077C5A"
          />
          <path
            d="M39.3713 125.106C38.923 125.109 38.4786 125.023 38.0636 124.853C37.6486 124.684 37.2712 124.434 36.9529 124.118C36.6336 123.801 36.3802 123.425 36.2073 123.01C36.0343 122.595 35.9453 122.149 35.9453 121.7C35.9453 121.25 36.0343 120.805 36.2073 120.39C36.3802 119.975 36.6336 119.598 36.9529 119.281L38.9285 117.306C40.7683 115.483 42.2276 113.312 43.2217 110.921C44.2158 108.529 44.7248 105.964 44.7191 103.374V82.1872C44.7175 74.7038 46.6125 67.3421 50.227 60.7895C53.8416 54.2369 59.0578 48.7073 65.3886 44.7169C71.7194 40.7266 78.9581 38.4058 86.4289 37.9712C93.8997 37.5366 101.359 39.0025 108.109 42.2319C108.545 42.4029 108.94 42.6618 109.271 42.9924C109.602 43.323 109.862 43.7182 110.033 44.1534C110.205 44.5886 110.285 45.0545 110.268 45.522C110.252 45.9896 110.139 46.4487 109.938 46.8708C109.736 47.2929 109.45 47.6689 109.096 47.9755C108.743 48.282 108.33 48.5125 107.884 48.6525C107.437 48.7925 106.967 48.8391 106.502 48.7893C106.037 48.7395 105.587 48.5944 105.18 48.3631C99.4663 45.6276 93.1522 44.3855 86.828 44.7527C80.5038 45.12 74.376 47.0847 69.0173 50.4633C63.6586 53.8418 59.244 58.5238 56.1861 64.0718C53.1281 69.6197 51.5268 75.8523 51.5316 82.1872V103.374C51.5342 106.854 50.8495 110.301 49.5167 113.516C48.184 116.731 46.2295 119.651 43.7654 122.108L41.7897 124.118C41.4715 124.434 41.094 124.684 40.679 124.853C40.264 125.023 39.8196 125.109 39.3713 125.106Z"
            fill="#077C5A"
          />
          <path
            d="M102.114 155.524C101.461 155.522 100.823 155.333 100.274 154.979C99.5203 154.496 98.9867 153.736 98.7891 152.862C98.5915 151.989 98.7457 151.073 99.2184 150.313C108.146 136.3 112.874 120.023 112.843 103.408V92.4063C112.843 91.5029 113.202 90.6365 113.841 89.9977C114.48 89.3589 115.346 89 116.25 89C117.153 89 118.019 89.3589 118.658 89.9977C119.297 90.6365 119.656 91.5029 119.656 92.4063V103.374C119.699 121.292 114.604 138.847 104.975 153.957C104.667 154.437 104.244 154.832 103.744 155.105C103.244 155.379 102.684 155.523 102.114 155.524Z"
            fill="#077C5A"
          />
          <path
            d="M61.75 95.8125C60.8466 95.8125 59.9802 95.4536 59.3414 94.8148C58.7026 94.176 58.3438 93.3096 58.3438 92.4062V82.1875C58.3353 74.385 61.3023 66.8729 66.6401 61.182C71.9779 55.491 79.2848 52.0496 87.0718 51.5588C94.8588 51.068 102.54 53.5649 108.55 58.5407C114.56 63.5165 118.447 70.5966 119.418 78.3384C119.535 79.2418 119.289 80.1549 118.733 80.8767C118.178 81.5985 117.358 82.07 116.454 82.1875C115.551 82.3049 114.638 82.0587 113.916 81.5029C113.194 80.9472 112.723 80.1274 112.605 79.224C111.764 73.2823 108.713 67.8762 104.062 64.0846C99.4103 60.2931 93.5001 58.395 87.5107 58.769C81.5214 59.1431 75.8933 61.7619 71.7497 66.1027C67.6061 70.4435 65.2516 76.1872 65.1563 82.1875V92.4062C65.1563 93.3096 64.7974 94.176 64.1586 94.8148C63.5198 95.4536 62.6534 95.8125 61.75 95.8125Z"
            fill="#077C5A"
          />
          <path
            d="M46.7281 137.028C46.0585 137.025 45.4046 136.825 44.8481 136.453C44.2915 136.081 43.8571 135.553 43.5991 134.935C43.341 134.317 43.2708 133.637 43.3972 132.979C43.5236 132.321 43.8409 131.716 44.3097 131.238L48.5675 126.946C54.2689 121.303 57.7405 113.792 58.3434 105.793C58.4039 104.931 58.7892 104.125 59.4216 103.537C60.054 102.949 60.8861 102.623 61.7497 102.625C62.2178 102.624 62.6811 102.719 63.1107 102.905C63.5403 103.091 63.927 103.363 64.2466 103.705C64.5663 104.047 64.812 104.452 64.9684 104.893C65.1249 105.334 65.1887 105.803 65.1559 106.27C64.4631 115.887 60.3273 124.933 53.5065 131.748L49.1465 136.006C48.8311 136.328 48.4549 136.584 48.0397 136.76C47.6246 136.935 47.1788 137.026 46.7281 137.028Z"
            fill="#077C5A"
          />
          <path
            d="M84.2317 156.92C83.5805 156.921 82.943 156.734 82.3946 156.383C81.8463 156.032 81.41 155.531 81.1376 154.939C80.8652 154.348 80.768 153.691 80.8576 153.046C80.9471 152.401 81.2197 151.795 81.6429 151.3C89.5995 141.96 95.0915 130.777 97.6182 118.77C97.829 117.91 98.3666 117.166 99.1169 116.695C99.8673 116.225 100.771 116.065 101.638 116.25C102.08 116.339 102.499 116.515 102.873 116.768C103.246 117.02 103.566 117.344 103.813 117.722C104.06 118.099 104.23 118.521 104.312 118.964C104.395 119.407 104.389 119.862 104.294 120.303C101.521 133.427 95.5149 145.65 86.8204 155.865C86.4882 156.214 86.0856 156.488 85.6394 156.67C85.1931 156.852 84.7133 156.938 84.2317 156.92Z"
            fill="#077C5A"
          />
          <path
            d="M60.6261 142.376C60.1778 142.379 59.7334 142.293 59.3184 142.123C58.9034 141.954 58.5259 141.704 58.2076 141.388C57.6218 140.737 57.3091 139.886 57.3344 139.011C57.3598 138.135 57.7213 137.303 58.3439 136.687C62.6985 132.335 66.1452 127.161 68.4841 121.466C70.823 115.77 72.0075 109.667 71.9689 103.511V82.1875C71.9689 77.6705 73.7632 73.3386 76.9572 70.1446C80.1512 66.9506 84.4832 65.1562 89.0001 65.1562C93.5171 65.1562 97.8491 66.9506 101.043 70.1446C104.237 73.3386 106.031 77.6705 106.031 82.1875V106.304C105.959 107.207 105.531 108.045 104.841 108.633C104.151 109.22 103.256 109.51 102.353 109.437C101.449 109.365 100.612 108.937 100.024 108.247C99.4362 107.557 99.1466 106.662 99.2189 105.759V82.1875C99.2189 79.4773 98.1423 76.8781 96.2259 74.9617C94.3095 73.0454 91.7103 71.9687 89.0001 71.9687C86.29 71.9687 83.6908 73.0454 81.7744 74.9617C79.858 76.8781 78.7814 79.4773 78.7814 82.1875V103.374C78.7998 110.436 77.4186 117.431 74.7175 123.956C72.0164 130.481 68.049 136.406 63.0445 141.388C62.7262 141.704 62.3488 141.954 61.9338 142.123C61.5187 142.293 61.0744 142.379 60.6261 142.376Z"
            fill="#077C5A"
          />
          <path
            d="M70.2658 152.016C69.8176 152.019 69.3732 151.933 68.9582 151.763C68.5432 151.594 68.1657 151.344 67.8474 151.028C67.5281 150.712 67.2747 150.335 67.1018 149.92C66.9289 149.505 66.8398 149.059 66.8398 148.61C66.8398 148.16 66.9289 147.715 67.1018 147.3C67.2747 146.885 67.5281 146.508 67.8474 146.191C68.8693 145.169 69.8571 144.148 70.7768 143.058C71.364 142.371 72.1999 141.946 73.1006 141.876C74.0013 141.805 74.893 142.096 75.5796 142.683C76.2662 143.27 76.6914 144.106 76.7616 145.007C76.8319 145.907 76.5415 146.799 75.9543 147.486C74.8983 148.712 73.8424 149.87 72.548 150.892C71.961 151.547 71.1432 151.95 70.2658 152.016Z"
            fill="#077C5A"
          />
          <path
            d="M79.292 140.639C78.6834 140.64 78.0855 140.478 77.5607 140.17C77.0358 139.862 76.6031 139.419 76.3076 138.887C76.012 138.355 75.8644 137.753 75.88 137.145C75.8957 136.536 76.0741 135.943 76.3967 135.427C82.4216 125.823 85.6097 114.712 85.5935 103.374V82.1875C85.5935 81.2841 85.9524 80.4177 86.5912 79.7789C87.23 79.1401 88.0964 78.7813 88.9998 78.7812C89.9032 78.7813 90.7696 79.1401 91.4084 79.7789C92.0472 80.4177 92.406 81.2841 92.406 82.1875V103.374C92.4189 115.986 88.8773 128.347 82.1873 139.038C81.8805 139.529 81.4536 139.933 80.9471 140.213C80.4405 140.494 79.8708 140.64 79.292 140.639Z"
            fill="#077C5A"
          />
          <path
            d="M143.5 102.625C142.597 102.625 141.731 102.266 141.092 101.627C140.453 100.989 140.094 100.122 140.094 99.2188V82.1875C140.094 71.4638 136.72 61.012 130.45 52.3125C124.18 43.613 115.331 37.1068 105.158 33.7157C94.9843 30.3246 84.0018 30.2204 73.7659 33.4178C63.53 36.6153 54.5596 42.9523 48.1254 51.5312C47.857 51.8891 47.5208 52.1906 47.1359 52.4185C46.7509 52.6464 46.3249 52.7963 45.8821 52.8595C45.4393 52.9228 44.9883 52.8982 44.555 52.7872C44.1217 52.6762 43.7145 52.4809 43.3566 52.2125C42.9988 51.9441 42.6973 51.6079 42.4694 51.223C42.2415 50.8381 42.0916 50.412 42.0284 49.9692C41.9651 49.5264 41.9897 49.0755 42.1007 48.6421C42.2117 48.2088 42.407 47.8016 42.6754 47.4437C49.9675 37.7209 60.1339 30.539 71.7346 26.9152C83.3353 23.2914 95.7821 23.4095 107.312 27.2528C118.842 31.0961 128.87 38.4697 135.976 48.3291C143.083 58.1886 146.907 70.034 146.907 82.1875V99.2188C146.907 100.122 146.548 100.989 145.909 101.627C145.27 102.266 144.404 102.625 143.5 102.625Z"
            fill="#077C5A"
          />
          <path
            d="M34.5001 102.625C33.5967 102.625 32.7303 102.266 32.0915 101.627C31.4527 100.988 31.0938 100.122 31.0938 99.2186V82.1874C31.0829 74.5387 32.6 66.9649 35.556 59.9105C35.9529 59.1624 36.6142 58.589 37.4109 58.3021C38.2076 58.0151 39.0827 58.0353 39.8654 58.3586C40.6481 58.6819 41.2823 59.2851 41.6443 60.0507C42.0063 60.8162 42.0702 61.6891 41.8235 62.4992C39.2399 68.7417 37.9089 75.4313 37.9063 82.1874V99.2186C37.9063 100.122 37.5474 100.988 36.9086 101.627C36.2698 102.266 35.4035 102.625 34.5001 102.625Z"
            fill="#077C5A"
          />
          <path
            d="M3.84375 44.7188C2.94036 44.7188 2.07396 44.3599 1.43517 43.7211C0.796372 43.0823 0.4375 42.2159 0.4375 41.3125V3.84375C0.4375 2.94036 0.796372 2.07396 1.43517 1.43517C2.07396 0.796372 2.94036 0.4375 3.84375 0.4375H41.3125C42.2159 0.4375 43.0823 0.796372 43.7211 1.43517C44.3599 2.07396 44.7188 2.94036 44.7188 3.84375C44.7188 4.74714 44.3599 5.61354 43.7211 6.25233C43.0823 6.89113 42.2159 7.25 41.3125 7.25H7.25V41.3125C7.25 42.2159 6.89113 43.0823 6.25233 43.7211C5.61354 44.3599 4.74714 44.7188 3.84375 44.7188ZM174.156 44.7188C173.253 44.7188 172.386 44.3599 171.748 43.7211C171.109 43.0823 170.75 42.2159 170.75 41.3125V7.25H136.688C135.784 7.25 134.918 6.89113 134.279 6.25233C133.64 5.61354 133.281 4.74714 133.281 3.84375C133.281 2.94036 133.64 2.07396 134.279 1.43517C134.918 0.796372 135.784 0.4375 136.688 0.4375H174.156C175.06 0.4375 175.926 0.796372 176.565 1.43517C177.204 2.07396 177.562 2.94036 177.562 3.84375V41.3125C177.562 42.2159 177.204 43.0823 176.565 43.7211C175.926 44.3599 175.06 44.7188 174.156 44.7188ZM174.156 177.562H136.688C135.784 177.562 134.918 177.204 134.279 176.565C133.64 175.926 133.281 175.06 133.281 174.156C133.281 173.253 133.64 172.386 134.279 171.748C134.918 171.109 135.784 170.75 136.688 170.75H170.75V136.688C170.75 135.784 171.109 134.918 171.748 134.279C172.386 133.64 173.253 133.281 174.156 133.281C175.06 133.281 175.926 133.64 176.565 134.279C177.204 134.918 177.562 135.784 177.562 136.688V174.156C177.562 175.06 177.204 175.926 176.565 176.565C175.926 177.204 175.06 177.562 174.156 177.562ZM41.3125 177.562H3.84375C2.94036 177.562 2.07396 177.204 1.43517 176.565C0.796372 175.926 0.4375 175.06 0.4375 174.156V136.688C0.4375 135.784 0.796372 134.918 1.43517 134.279C2.07396 133.64 2.94036 133.281 3.84375 133.281C4.74714 133.281 5.61354 133.64 6.25233 134.279C6.89113 134.918 7.25 135.784 7.25 136.688V170.75H41.3125C42.2159 170.75 43.0823 171.109 43.7211 171.748C44.3599 172.386 44.7188 173.253 44.7188 174.156C44.7188 175.06 44.3599 175.926 43.7211 176.565C43.0823 177.204 42.2159 177.562 41.3125 177.562Z"
            fill="#077C5A"
          />
        </svg>
      )}
    </div>
  );
};

export default FingerPrintCapture;
